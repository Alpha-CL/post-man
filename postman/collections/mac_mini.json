{
	"info": {
		"_postman_id": "bf38d7fd-2890-4592-be5f-20d72b3b2fe9",
		"name": "mac_mini",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_uid": "9821396-bf38d7fd-2890-4592-be5f-20d72b3b2fe9"
	},
	"item": [
		{
			"name": "api",
			"item": [
				{
					"name": "demo",
					"item": [
						{
							"name": "/",
							"id": "93b28a50-2ce7-4e7c-96aa-0e95586a7c6d",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "formdata",
									"formdata": [
										{
											"key": "name",
											"value": "foo",
											"type": "text"
										},
										{
											"key": "age",
											"value": "18",
											"type": "text"
										}
									]
								},
								"url": {
									"raw": "{{mac_mini}}",
									"host": [
										"{{mac_mini}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "/<id>",
							"id": "67700cbf-3522-4a08-938a-0cb0882987a3",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "DELETE",
								"header": [],
								"url": {
									"raw": "{{mac_mini}}/1",
									"host": [
										"{{mac_mini}}"
									],
									"path": [
										"1"
									]
								}
							},
							"response": []
						},
						{
							"name": "/",
							"id": "bf1ed91b-d7db-4d21-83dd-bf0a59b38172",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "PUT",
								"header": [],
								"body": {
									"mode": "formdata",
									"formdata": [
										{
											"key": "id",
											"value": "1",
											"type": "text"
										},
										{
											"key": "name",
											"value": "bar",
											"type": "text"
										}
									]
								},
								"url": {
									"raw": "{{mac_mini}}",
									"host": [
										"{{mac_mini}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "/",
							"id": "54bcbdd3-619c-416a-b9a5-0ee26bcc4338",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "GET",
								"header": [],
								"body": {
									"mode": "formdata",
									"formdata": []
								},
								"url": {
									"raw": "{{mac_mini}}",
									"host": [
										"{{mac_mini}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "/<id>",
							"id": "2b2f5dab-f562-4af6-9bf0-52d303959bc3",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{mac_mini}}/1",
									"host": [
										"{{mac_mini}}"
									],
									"path": [
										"1"
									]
								}
							},
							"response": []
						}
					],
					"id": "679455f6-63d4-426c-aef1-3a3a887ce09e",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"id": "b31e2aa2-f29b-43d4-a5d0-cee7f7b13983",
								"type": "text/javascript",
								"exec": [
									"(function (server_name, controller_prefix) {",
									"    const prev_url = pm.collectionVariables.get(server_name)",
									"    const controller_url = `${prev_url}${controller_prefix}`",
									"    // console.log('-> controller_url', controller_url)",
									"    pm.collectionVariables.set(server_name, controller_url)",
									"}('mac_mini', '/demo'))"
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"id": "fbbc29ba-fb02-410a-9168-99f56e6b3ef2",
								"type": "text/javascript",
								"exec": [
									""
								]
							}
						}
					]
				}
			],
			"id": "51cf8cc1-b38b-453a-8e72-9cfccbc9983a"
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"id": "c4c695ad-7bca-445f-bd4a-656222bedcf9",
				"type": "text/javascript",
				"exec": [
					"class GlobalServer {",
					"",
					"    env = pm.environment.name // 当前的环境变量",
					"    ",
					"    constructor(...args) {",
					"        console.log('-> env: ', this.env)",
					"        const kwargs = args[0] || {}",
					"        const {server_name, host = null, port = null, prefix = null} = {...kwargs}",
					"        this.__server_name = server_name",
					"        this.__host = host",
					"        this.__port = port",
					"        this.__host_key = host || `${server_name}_host`",
					"        this.__port_key = port || `${server_name}_port`",
					"        this.__prefix = prefix",
					"    }",
					"",
					"    init() {",
					"        this._init_url(this.__host_key, this.__port_key)",
					"        this.setup()",
					"    }",
					"",
					"    setup() {",
					"        pm.globals.set(this.__server_name, this)",
					"    }",
					"",
					"    _init_url = (host_key = this.__host_key, port_key = this.__port_key, prefix_key = this.__prefix)=> {",
					"        this.__host = this.__host || this._get_vaiable(host_key) || 'localhost'",
					"        this.__port = this.__port || this._get_vaiable(port_key) || 80",
					"        this.__prefix = prefix_key || this._get_vaiable(prefix_key) || ''",
					"        this.__url = `${this.__host}:${this.__port}${this.__prefix}`",
					"        pm.collectionVariables.set(this.__server_name, this.__url)",
					"        // this._log()",
					"    }",
					"",
					"    _get_vaiable = (key) => {",
					"        const global_vaibale = pm.globals.get(key) // 全局变量",
					"        const collection_variable = pm.collectionVariables.get(key) // 集合变量",
					"        const env_variable = pm.environment.get(key) // 环境变量",
					"        const local_variable = pm.variables.get(key) // 本地变量",
					"        return local_variable || collection_variable || env_variable || global_vaibale",
					"    }",
					"",
					"    _log = () => {",
					"        console.log('-> server_name: ', this.__server_name)",
					"        console.log('-> host: ', this.__host)",
					"        console.log('-> port: ', this.__port)",
					"        console.log('-> host_key: ', this.__host_key)",
					"        console.log('-> port_key: ', this.__port_key)",
					"        console.log('-> prefix: ', this.__prefix)",
					"        console.log('-> url: ', this.__url)",
					"    }",
					"}",
					"",
					"",
					"const server = new GlobalServer({",
					"    server_name: 'mac_mini',",
					"    prefix: '/api',",
					"    // host: '',",
					"    // port: '',",
					"    // host_key: '',",
					"    // port_key: ''",
					"})",
					"server.init()",
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"id": "31992fa4-9835-40d3-ad37-ae3755fba519",
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"id": "f252204e-9b89-4f3c-acd0-e75514834c7e",
			"key": "mac_mini",
			"value": ""
		}
	]
}